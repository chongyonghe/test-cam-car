<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Beach Cleaning Robot Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body onload="initWebSocket()">
  <nav class="navbar navbar-expand-lg customernavbar">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Beach Cleaning Robot</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="#home">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#map-section">Live Camera Feed</a></li>
          <li class="nav-item"><a class="nav-link" href="#remote-control">Remote Control</a></li>
          <li class="nav-item"><a class="nav-link" href="#history">Cleaning History</a></li>
          <li class="nav-item"><a class="nav-link" href="#schedule">Schedule Cleaning</a></li>
          <li class="nav-item"><a class="nav-link" href="#coverage">Area Coverage Map</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div id="header-image">
    <img src="21.jpg" alt="" width="100%" />
  </div>

  <!-- üì∏ Live Camera Feed -->
  <section id="map-section" class="text-center my-5">
    
    <h3>üì∏ Live Camera Feed</h3>
    <img id="cameraImage" src="" style="width:380px;height:300px" />
  </section>

  <!-- ‚öôÔ∏è Remote Control Section -->
  <section id="remote-control" class="text-center my-4">
    <h3>‚öôÔ∏è Remote Control</h3>
    <div class="d-flex justify-content-center">
      <table>
        <tr>
          <td></td>
          <td><button class="btn btn-secondary" ontouchstart='sendButtonInput("MoveCar","1")' ontouchend='sendButtonInput("MoveCar","0")'>‚Üë</button></td>
          <td></td>
        </tr>
        <tr>
          <td><button class="btn btn-secondary" ontouchstart='sendButtonInput("MoveCar","3")' ontouchend='sendButtonInput("MoveCar","0")'>‚Üê</button></td>
          <td></td>
          <td><button class="btn btn-secondary" ontouchstart='sendButtonInput("MoveCar","4")' ontouchend='sendButtonInput("MoveCar","0")'>‚Üí</button></td>
        </tr>
        <tr>
          <td></td>
          <td><button class="btn btn-secondary" ontouchstart='sendButtonInput("MoveCar","2")' ontouchend='sendButtonInput("MoveCar","0")'>‚Üì</button></td>
          <td></td>
        </tr>
      </table>
    </div>

    <div class="mt-4">
      <label><strong>Speed:</strong></label>
      <input type="range" min="0" max="255" value="150" class="form-range w-50" id="Speed" oninput='sendButtonInput("Speed",value)' />
    </div>
    <div class="mt-3">
      <label><strong>Light:</strong></label>
      <input type="range" min="0" max="255" value="0" class="form-range w-50" id="Light" oninput='sendButtonInput("Light",value)' />
    </div>

    <!-- üîò Automation Control Buttons -->
    <div class="mt-4">
      <button class="btn btn-primary" onclick="sendCommand('start')">Start Automation</button>
      <button class="btn btn-danger" onclick="sendCommand('stop')">Stop Automation</button>
    </div>
  </section>

  <hr />

  <section id="history" class="container">
    <h3>üìú Cleaning History</h3>
    <ul id="history"></ul>
  </section>

  <hr />

  <section id="schedule" class="container">
    <h3>üìÖ Schedule Cleaning</h3>
    <input type="time" id="scheduleTime" class="form-control w-25 d-inline" />
    <button class="btn btn-success" onclick="setSchedule()">Set Schedule</button>
  </section>

  <hr />

  <section id="coverage" class="container text-center">
    <h3>üìä Area Coverage Map</h3>
    <canvas id="coverageCanvas" width="400" height="400" style="border:1px solid black;"></canvas>
  </section>

  <!-- ‚úÖ Scripts -->
  <script>
    var webSocketCameraUrl = "ws://" + window.location.hostname + "/Camera";
    var webSocketCarInputUrl = "ws://" + window.location.hostname + "/CarInput";
    var websocketCamera;
    var websocketCarInput;

    function initCameraWebSocket() {
      websocketCamera = new WebSocket(webSocketCameraUrl);
      websocketCamera.binaryType = 'blob';
      websocketCamera.onmessage = function (event) {
        document.getElementById("cameraImage").src = URL.createObjectURL(event.data);
      };
      websocketCamera.onclose = function () {
        setTimeout(initCameraWebSocket, 2000);
      };
    }

    function initCarInputWebSocket() {
      websocketCarInput = new WebSocket(webSocketCarInputUrl);
      websocketCarInput.onopen = function () {
        sendButtonInput("Speed", document.getElementById("Speed").value);
        sendButtonInput("Light", document.getElementById("Light").value);
      };
      websocketCarInput.onclose = function () {
        setTimeout(initCarInputWebSocket, 2000);
      };
    }

    function initWebSocket() {
      initCameraWebSocket();
      initCarInputWebSocket();
    }

    function sendButtonInput(key, value) {
      var data = key + "," + value;
      if (websocketCarInput.readyState === WebSocket.OPEN) {
        websocketCarInput.send(data);
      }
    }

    function sendCommand(command) {
      fetch("http://your-server.com/control?cmd=" + command);
    }

    function setSchedule() {
      const time = document.getElementById("scheduleTime").value;
      fetch("http://your-server.com/set_schedule?time=" + time);
    }

    document.getElementById("remote-control").addEventListener("touchend", function(event) {
      event.preventDefault();
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>